# User Data Flow Diagram

## Overview
This diagram shows how user data flows from various database tables to the Dashboard user cards.

## Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DATABASE TABLES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ master_user_list â”‚      â”‚    branches      â”‚      â”‚ vpn_rdp_creds    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ id             â”‚â—„â”€â”€â”€â”€â”â”‚ â€¢ id             â”‚      â”‚ â€¢ id             â”‚  â”‚
â”‚  â”‚ â€¢ email          â”‚     â”‚â”‚ â€¢ name           â”‚      â”‚ â€¢ username       â”‚  â”‚
â”‚  â”‚ â€¢ display_name   â”‚     â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â€¢ password       â”‚  â”‚
â”‚  â”‚ â€¢ job_title      â”‚     â”‚                          â”‚ â€¢ service_type   â”‚  â”‚
â”‚  â”‚ â€¢ branch_id â”€â”€â”€â”€â”€â”˜     â”‚                          â”‚ â€¢ email          â”‚  â”‚
â”‚  â”‚ â€¢ vpn_username   â”‚     â”‚                          â”‚ â€¢ notes          â”‚  â”‚
â”‚  â”‚ â€¢ rdp_username   â”‚     â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ â€¢ is_active      â”‚     â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                                                â”‚
â”‚          â”‚                â”‚                                                â”‚
â”‚          â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚          â”‚                â”‚  â”‚ device_user_     â”‚   â”‚ hardware_        â”‚  â”‚
â”‚          â”‚                â”‚  â”‚ assignments      â”‚   â”‚ inventory        â”‚  â”‚
â”‚          â”‚                â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ user_email     â”‚   â”‚ â€¢ serial_number  â”‚  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ device_serial  â”‚   â”‚ â€¢ device_name    â”‚  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ device_name    â”‚   â”‚ â€¢ model          â”‚  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ device_model   â”‚   â”‚ â€¢ m365_user_emailâ”‚  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ is_current     â”‚   â”‚ â€¢ device_type    â”‚  â”‚
â”‚          â”‚                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â€¢ status         â”‚  â”‚
â”‚          â”‚                â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                â”‚                                                â”‚
â”‚          â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚          â”‚                â”‚  â”‚ directory_users  â”‚   â”‚    profiles      â”‚  â”‚
â”‚          â”‚                â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ email          â”‚   â”‚ â€¢ user_id        â”‚  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ display_name   â”‚   â”‚ â€¢ email          â”‚  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ upn            â”‚   â”‚ â€¢ full_name      â”‚  â”‚
â”‚          â”‚                â”‚  â”‚ â€¢ account_enabledâ”‚   â”‚ â€¢ branch_id      â”‚  â”‚
â”‚          â”‚                â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                â”‚
           â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATA CONSOLIDATION LAYER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ fetchDirectoryUsers()                                                â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ 1. Query master_user_list WITH JOIN to branches                     â”‚    â”‚
â”‚  â”‚    SELECT * FROM master_user_list                                    â”‚    â”‚
â”‚  â”‚    LEFT JOIN branches ON master_user_list.branch_id = branches.id   â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ 2. Enrich with directory_users (M365/Intune data)                   â”‚    â”‚
â”‚  â”‚    â€¢ Add account_enabled status                                      â”‚    â”‚
â”‚  â”‚    â€¢ Add user_principal_name                                         â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ 3. Call enrichUsersWithStats() for each user                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ enrichUsersWithStats()                                               â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ VPN CREDENTIALS (deduplicated by username):                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ vpn_rdp_credentials WHERE service_type = 'VPN'                 â”‚    â”‚
â”‚  â”‚  â””â”€ master_user_list.vpn_username                                   â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ RDP CREDENTIALS (deduplicated by username):                         â”‚    â”‚
â”‚  â”‚  â”œâ”€ vpn_rdp_credentials WHERE service_type = 'RDP'                 â”‚    â”‚
â”‚  â”‚  â””â”€ master_user_list.rdp_username                                   â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ DEVICES (deduplicated by serial_number):                            â”‚    â”‚
â”‚  â”‚  â”œâ”€ device_user_assignments WHERE is_current = true                â”‚    â”‚
â”‚  â”‚  â””â”€ hardware_inventory                                               â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ STAFF STATUS:                                                        â”‚    â”‚
â”‚  â”‚  â””â”€ profiles (check if email exists)                                â”‚    â”‚
â”‚  â”‚                                                                       â”‚    â”‚
â”‚  â”‚ OUTPUT: UserWithStats {                                              â”‚    â”‚
â”‚  â”‚   email, display_name, job_title, branch_name,                      â”‚    â”‚
â”‚  â”‚   vpnCount, rdpCount, deviceCount,                                  â”‚    â”‚
â”‚  â”‚   vpnCredentials[], rdpCredentials[], devices[],                    â”‚    â”‚
â”‚  â”‚   deviceType, account_enabled, staffUser                            â”‚    â”‚
â”‚  â”‚ }                                                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER INTERFACE LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ User Card Display                                                â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚                                                                   â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚        â”‚
â”‚  â”‚  â”‚          ğŸ‘¤ John Doe                                 â”‚        â”‚        â”‚
â”‚  â”‚  â”‚          john@example.com                            â”‚        â”‚        â”‚
â”‚  â”‚  â”‚          Manager - IT                                â”‚        â”‚        â”‚
â”‚  â”‚  â”‚          ğŸ¢ Sydney Branch                            â”‚        â”‚        â”‚
â”‚  â”‚  â”‚                                                       â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  Credentials & Devices:                             â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                      â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“¶ 2 â”‚  â”‚ ğŸ–¥ï¸ 1 â”‚  â”‚ ğŸ’» 1 â”‚                      â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â”‚ VPN  â”‚  â”‚ RDP  â”‚  â”‚Deviceâ”‚                      â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                      â”‚        â”‚        â”‚
â”‚  â”‚  â”‚                                                       â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â”‚   ğŸ’» Full PC     â”‚                               â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â”‚   âœ“ Active       â”‚                               â”‚        â”‚        â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚        â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚        â”‚
â”‚  â”‚                                                                   â”‚        â”‚
â”‚  â”‚  Data Sources:                                                   â”‚        â”‚
â”‚  â”‚  â€¢ Name, Email, Job: master_user_list                           â”‚        â”‚
â”‚  â”‚  â€¢ Branch: branches table (via branch_id JOIN)                  â”‚        â”‚
â”‚  â”‚  â€¢ VPN count: vpn_rdp_credentials + master_user_list           â”‚        â”‚
â”‚  â”‚  â€¢ RDP count: vpn_rdp_credentials + master_user_list           â”‚        â”‚
â”‚  â”‚  â€¢ Device count: device_user_assignments + hardware_inventory   â”‚        â”‚
â”‚  â”‚  â€¢ Device type: Calculated from credentials & devices           â”‚        â”‚
â”‚  â”‚  â€¢ Account status: directory_users.account_enabled              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ User Details Dialog (on card click)                             â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚                                                                   â”‚        â”‚
â”‚  â”‚  Shows full details including:                                   â”‚        â”‚
â”‚  â”‚  â€¢ All VPN credentials with usernames                           â”‚        â”‚
â”‚  â”‚  â€¢ All RDP credentials with usernames                           â”‚        â”‚
â”‚  â”‚  â€¢ All M365 credentials                                          â”‚        â”‚
â”‚  â”‚  â€¢ All device details (serial, model, name)                     â”‚        â”‚
â”‚  â”‚  â€¢ Branch assignment (editable dropdown)                         â”‚        â”‚
â”‚  â”‚  â€¢ Antivirus status                                              â”‚        â”‚
â”‚  â”‚  â€¢ Device type reasoning                                         â”‚        â”‚
â”‚  â”‚                                                                   â”‚        â”‚
â”‚  â”‚  Data fetched from:                                              â”‚        â”‚
â”‚  â”‚  â€¢ master_user_list (base data)                                 â”‚        â”‚
â”‚  â”‚  â€¢ vpn_rdp_credentials (all credentials)                        â”‚        â”‚
â”‚  â”‚  â€¢ device_user_assignments (current device)                     â”‚        â”‚
â”‚  â”‚  â€¢ hardware_inventory (device details + antivirus)              â”‚        â”‚
â”‚  â”‚  â€¢ branches (branch dropdown list)                              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Mapping Flow

### Master CSV Page â†’ Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Master User Data    â”‚
â”‚  (CSV Import Page)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Import CSV
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  master_user_list    â”‚
â”‚  â€¢ email             â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â€¢ display_name      â”‚         â”‚
â”‚  â€¢ job_title         â”‚         â”‚
â”‚  â€¢ branch_id â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â€¢ vpn_username      â”‚      â”‚  â”‚
â”‚  â€¢ rdp_username      â”‚      â”‚  â”‚
â”‚  â€¢ is_active         â”‚      â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚
                              â”‚  â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
           â”‚                     â”‚
           â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     branches         â”‚        â”‚
â”‚  â€¢ id                â”‚        â”‚
â”‚  â€¢ name  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ User Card     â”‚
                        â”‚ â€¢ Name        â”‚
                        â”‚ â€¢ Email       â”‚
                        â”‚ â€¢ Job Title   â”‚
                        â”‚ â€¢ Branch Name â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### VPN Page â†’ Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     VPN Page         â”‚
â”‚  (Add/Edit VPN)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Add/Edit
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vpn_rdp_credentials     â”‚
â”‚  â€¢ service_type = 'VPN'  â”‚ â”€â”€â”€â”
â”‚  â€¢ username              â”‚    â”‚
â”‚  â€¢ password              â”‚    â”‚
â”‚  â€¢ email                 â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  master_user_list        â”‚    â”‚
â”‚  â€¢ vpn_username          â”‚â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                â”‚
        Deduplicated by         â”‚
        username                â”‚
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ User Card     â”‚
                        â”‚ ğŸ“¶ VPN Count  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RDP Page â†’ Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     RDP Page         â”‚
â”‚  (Add/Edit RDP)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Add/Edit
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vpn_rdp_credentials     â”‚
â”‚  â€¢ service_type = 'RDP'  â”‚ â”€â”€â”€â”
â”‚  â€¢ username              â”‚    â”‚
â”‚  â€¢ password              â”‚    â”‚
â”‚  â€¢ email                 â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  master_user_list        â”‚    â”‚
â”‚  â€¢ rdp_username          â”‚â”€â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                â”‚
        Deduplicated by         â”‚
        username                â”‚
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ User Card     â”‚
                        â”‚ ğŸ–¥ï¸ RDP Count  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Device Assignments â†’ Dashboard

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Device Assignment       â”‚
â”‚  (Intune/Manual)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Assign
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ device_user_assignments  â”‚
â”‚  â€¢ user_email            â”‚ â”€â”€â”€â”
â”‚  â€¢ device_serial_number  â”‚    â”‚
â”‚  â€¢ device_name           â”‚    â”‚
â”‚  â€¢ is_current            â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  hardware_inventory      â”‚    â”‚
â”‚  â€¢ m365_user_email       â”‚â”€â”€â”€â”€â”¤
â”‚  â€¢ serial_number         â”‚    â”‚
â”‚  â€¢ device_name           â”‚    â”‚
â”‚  â€¢ model                 â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                â”‚
        Deduplicated by         â”‚
        serial_number           â”‚
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ User Card     â”‚
                        â”‚ ğŸ’» Device Cnt â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Deduplication Strategy

### Credentials Deduplication
```
VPN Credentials Map:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key: username + "VPN"                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ "jdoe-VPN" â†’ { username: "jdoe" }      â”‚
â”‚ "jsmith-VPN" â†’ { username: "jsmith" }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RDP Credentials Map:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key: username + "RDP"                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ "jdoe-RDP" â†’ { username: "jdoe" }      â”‚
â”‚ "jsmith-RDP" â†’ { username: "jsmith" }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Process:
1. Fetch from vpn_rdp_credentials
2. Add to map if key doesn't exist
3. Fetch from master_user_list
4. Add to map if key doesn't exist (avoids duplicates)
5. Count size of map for badge
```

### Device Deduplication
```
Device Serial Set:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Set<serial_number>                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ "ABC123"                                â”‚
â”‚ "DEF456"                                â”‚
â”‚ "GHI789"                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Process:
1. Fetch from device_user_assignments
2. Add serial to set (O(1) lookup)
3. Fetch from hardware_inventory
4. Only add if serial not in set (avoids duplicates)
5. Count size of set for badge
```

## Performance Optimizations

### Batch Queries
```
Instead of:
  For each user:
    Query VPN credentials
    Query RDP credentials
    Query devices

We do:
  Query ALL VPN credentials once
  Query ALL RDP credentials once
  Query ALL devices once
  Map by email in memory (O(1) lookups)
```

### Map-based Lookups
```
Map<email, credentials[]>
Time Complexity: O(1) for lookup
Space Complexity: O(n) where n = number of users

Better than nested loops:
O(n * m) where m = average credentials per user
```

### Limited Result Sets
```
.limit(500) on user queries
Prevents performance issues with large datasets
Pagination can be added if needed
```

## Summary

This data flow diagram shows:
- âœ… How data flows from 7 database tables
- âœ… Where each piece of user information comes from
- âœ… How credentials and devices are deduplicated
- âœ… How the UI displays consolidated data
- âœ… The complete mapping from CSV/VPN/RDP pages to dashboard

The system efficiently consolidates data from multiple sources while maintaining data integrity through proper deduplication and providing a clear, visual representation on the user dashboard cards.
